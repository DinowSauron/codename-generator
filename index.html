<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gerador de Tabuleiro — Configuração</title>
  <link rel="icon" href="./icons/favicon.svg" type="image/svg+xml">
  <style>
    :root {
      --ui-pad: 14px;
      --big-font: 18px;
      --muted: #666;
      --accent: #0077ff;
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 0;
      padding: 16px;
      background: #f6f7fb;
      color: #111;
      -webkit-font-smoothing: antialiased;
    }

    header {
      text-align: center;
      margin-bottom: 12px;
    }

    h1 {
      font-size: 20px;
      margin: 6px 0;
    }

    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(20, 20, 30, 0.06);
      margin-bottom: 12px;
    }

    label {
      display: block;
      font-size: 14px;
      margin-bottom: 6px;
    }

    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 12px;
    }

    select {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid #ddd;
      box-sizing: border-box;
    }

    .col {
      flex: 1;
    }

    .preview {
      margin-top: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .preview-grid {
      display: grid;
      gap: 6px;
      padding: 8px;
      background: linear-gradient(180deg, #fff, #fbfbff);
      border-radius: 10px;
    }

    .cell {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      background: #eee;
    }

    .meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      margin-top: 8px;
    }

    .danger {
      color: #b00020;
      font-weight: 600;
    }

    .controls {
      display: flex;
      gap: 12px;
      margin-top: 12px;
    }

    button {
      flex: 1;
      padding: 14px;
      font-size: var(--big-font);
      border-radius: 12px;
      border: 0;
      cursor: pointer;
    }

    button.primary {
      background: #0077ff;
      color: white;
      box-shadow: 0 6px 16px rgba(0, 119, 255, 0.18);
    }

    button.ghost {
      background: #fff;
      border: 1px solid #ddd;
    }

    .hint {
      font-size: 13px;
      color: var(--muted);
      margin-top: 8px;
    }

    @media (max-width:420px) {
      .cell {
        width: 22px;
        height: 22px;
        border-radius: 5px;
      }

      select {
        padding: 10px;
        font-size: 16px;
      }

      button {
        padding: 12px;
        font-size: 17px;
      }
    }

    .credits {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100vw;

      color: #000;
      /* default (light mode) */
      font-size: 14px;
      margin-bottom: 0.5rem;

      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;

    }

    .credits p {
      margin: 0;
    }

    .credits a {
      color: #9aade4;
    }

    .credits a&:hover {
      opacity: .72;
    }

    /* Dark mode overrides applied when body has class 'dark' */
    body.dark {
      background: #0b1220;
      color: #e6eef8;
    }

    body.dark .card {
      background: #0f1724;
      color: #e6eef8
    }

    body.dark select {
      background: #0b1220;
      color: #e6eef8;
      border-color: #223049
    }

    body.dark .hint {
      color: #9fb0d0
    }

    body.dark button.ghost {
      background: #0f1724;
      color: #e6eef8;
      border-color: #243146
    }

    body.dark .preview-grid {
      background: linear-gradient(180deg, #0f1724, #0b1220);
    }

    /* credits in dark mode */
    body.dark .credits {
      color: #c8d9ee
    }

    body.dark .credits a {
      color: #7fa1e8
    }
  </style>
</head>

<body>
  <header>
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;width:100%">
      <h1>Gerador de Tabuleiro</h1>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="themeToggle" class="ghost" aria-label="Alternar tema" title="Alternar tema"
          style="padding:8px 10px;font-size:13px;border-radius:10px;"></button>
      </div>
    </div>
    <div class="hint">Configure a grade e gere o tabuleiro — pensado para celular</div>
  </header>

  <main>
    <section class="card">
      <div class="row">
        <div class="col">
          <label for="largura">Largura (colunas)</label>
          <select id="largura"></select>
        </div>
        <div class="col">
          <label for="altura">Altura (linhas)</label>
          <select id="altura"></select>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label for="itens">Itens (coloridos)</label>
          <select id="itens"></select>
        </div>
        <div class="col">
          <label for="exclusoes">Exclusões (pretos)</label>
          <select id="exclusoes"></select>
        </div>
      </div>

      <div class="meta">
        <div>Total (itens + exclusões): <strong id="totalDisplay">18</strong></div>
        <div id="capacidade" class="hint">Capacidade: <strong id="capacidadeVal">25</strong></div>
      </div>

      <div id="erro" class="hint danger" style="display:none;margin-top:8px"></div>

      <div class="preview">
        <div>
          <label style="font-size:13px;margin-bottom:6px;display:block">Exemplo do grid</label>
          <div id="previewGrid" class="preview-grid"></div>
        </div>
      </div>

      <div class="controls" style="margin-top:14px;">
        <button id="gerarBtn" class="primary">Gerar Tabuleiro</button>
        <button id="limparBtn" class="ghost">Limpar</button>
      </div>

      <div class="hint">Observações: se <strong>total</strong> for maior que <strong>largura × altura</strong>, o botão
        ficará desabilitado.</div>
    </section>

    <section style="text-align:center; font-size:13px; color:var(--muted)">
      <footer class="credits">
        <p>Luiz Claudio</p>
        <p>•</p>
        <a href="http://luizclaudio.dev.br/" target="_blank" rel="noreferrer">
          Portfólio
        </a>
        <a href="https://github.com/DinowSauron" target="_blank" rel="noreferrer">
          Github
        </a>
        <a href="https://www.linkedin.com/in/luiz-claudio-cardoso/" target="_blank" rel="noreferrer">
          Linkedin
        </a>
        <p>•</p>
        <a href="https://github.com/DinowSauron/codename-generator" target="_blank" rel="noreferrer">
          Código Fonte
        </a>
      </footer>
    </section>
  </main>
  <script>
    const larguraSel = document.getElementById('largura');
    const alturaSel = document.getElementById('altura');
    const itensSel = document.getElementById('itens');
    const exclSel = document.getElementById('exclusoes');
    const totalDisplay = document.getElementById('totalDisplay');
    const capacidadeVal = document.getElementById('capacidadeVal');
    const previewGrid = document.getElementById('previewGrid');
    const erro = document.getElementById('erro');
    const gerarBtn = document.getElementById('gerarBtn');
    const limparBtn = document.getElementById('limparBtn');
    const themeToggle = document.getElementById('themeToggle');

    // Largura e altura apenas de 2 a 8
    for (let i = 2; i <= 8; i++) {
      larguraSel.innerHTML += `<option value="${i}">${i}</option>`;
      alturaSel.innerHTML += `<option value="${i}">${i}</option>`;
    }

    function updateItens() {
      const largura = +larguraSel.value;
      const altura = +alturaSel.value;
      const total = largura * altura;
      itensSel.innerHTML = '';

      // Itens sempre ímpares: 3 até total (se total for ímpar) ou total-1 (se total for par)
      const maxItens = total % 2 === 0 ? total - 1 : total;
      for (let i = 3; i <= maxItens; i += 2) {
        itensSel.innerHTML += `<option value="${i}">${i}</option>`;
      }

      // Define valor padrão para itens (17 se disponível, senão o primeiro disponível)
      if (itensSel.querySelector('option[value="17"]')) {
        itensSel.value = "17";
      } else if (itensSel.options.length > 0) {
        itensSel.value = itensSel.options[0].value;
      }

      updateExclusoes();
    }

    function updateExclusoes() {
      const largura = +larguraSel.value;
      const altura = +alturaSel.value;
      const total = largura * altura;
      const itens = +itensSel.value;
      exclSel.innerHTML = '';

      // Exclusões de 0 até total-itens
      for (let i = 0; i <= total - itens; i++) {
        exclSel.innerHTML += `<option value="${i}">${i}</option>`;
      }

      // Define valor padrão para exclusões (1 se disponível, senão 0)
      if (exclSel.querySelector('option[value="1"]')) {
        exclSel.value = "1";
      } else if (exclSel.options.length > 0) {
        exclSel.value = "0";
      }

      atualizaUI();
    }

    function atualizaUI() {
      const largura = +larguraSel.value;
      const altura = +alturaSel.value;
      const itens = +itensSel.value;
      const exclusoes = +exclSel.value;
      const capacidade = largura * altura;
      const total = itens + exclusoes;
      totalDisplay.textContent = total;
      capacidadeVal.textContent = capacidade;

      if (total > capacidade) {
        erro.style.display = 'block';
        erro.textContent = `Total (${total}) excede a capacidade ${capacidade}.`;
        gerarBtn.disabled = true;
        gerarBtn.style.opacity = 0.6;
      } else {
        erro.style.display = 'none';
        gerarBtn.disabled = false;
        gerarBtn.style.opacity = 1;
      }

      renderPreview(largura, altura);
    }

    function renderPreview(w, h) {
      const max = 8;
      const previewW = Math.min(w, max);
      const previewH = Math.min(h, max);
      previewGrid.innerHTML = '';
      previewGrid.style.gridTemplateColumns = `repeat(${previewW}, auto)`;
      for (let i = 0; i < previewW * previewH; i++) {
        const d = document.createElement('div');
        d.className = 'cell';
        previewGrid.appendChild(d);
      }
    }

    [larguraSel, alturaSel].forEach(el => el.addEventListener('change', updateItens));
    itensSel.addEventListener('change', updateExclusoes);
    exclSel.addEventListener('change', atualizaUI);

    gerarBtn.addEventListener('click', () => {
      const config = {
        largura: +larguraSel.value,
        altura: +alturaSel.value,
        itens: +itensSel.value,
        exclusoes: +exclSel.value
      };
      if (config.itens + config.exclusoes > config.largura * config.altura) {
        alert('Erro: total maior que capacidade.');
        return;
      }
      localStorage.setItem('tabuleiroConfig', JSON.stringify(config));
      window.location.href = 'board.html';
    });

    limparBtn.addEventListener('click', () => {
      larguraSel.value = '5';
      alturaSel.value = '5';
      updateItens();
    });

    // Inicialização
    larguraSel.value = '5';
    alturaSel.value = '5';
    updateItens();

    // Theme (dark mode) handling: persist in localStorage and apply class on body
    (function () {
      try {
        const saved = localStorage.getItem('siteTheme');
        if (saved === 'dark') document.body.classList.add('dark');
      } catch (e) {/* ignore */ }
    })();

    // Icon file paths — external SVG files inside ./icons/
    const moonSVG = './icons/moon.svg';
    const sunSVG = './icons/sun.svg';

    function updateThemeIcon(isDark) {
      if (!themeToggle) return;
      const path = isDark ? sunSVG : moonSVG;
      // use <img> so the button loads the external SVG file
      themeToggle.innerHTML = `<img src="${path}" alt="tema" style="width:18px;height:18px;display:block;">`;
    }

    // initialize icon state
    updateThemeIcon(document.body.classList.contains('dark'));

    themeToggle.addEventListener('click', () => {
      const isDark = document.body.classList.toggle('dark');
      try { localStorage.setItem('siteTheme', isDark ? 'dark' : 'light'); } catch (e) { }
      updateThemeIcon(isDark);
    });
  </script>
</body>

</html>